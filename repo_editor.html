<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4re5 repository json editor</title>
    <style>
        input, select {
            color: white;
            background-color: #444;
            border: 1px solid black;
            padding: 2px;
        }
        label {
            margin-top: 5px;
        }
    </style>
</head>
<body style="height: 100vh; overflow: hidden; background-color: #323232; color: white; font-family: monospace;">
    <script>
        // init list of apps + current app
        var map = [];
        var current_app = 0;
    </script>

    <h1>4re5 repository json editor</h1>
    <div style="align-items: center; justify-content: center; display: flex; flex-direction: column; position: absolute; right: 0px; top: 0px; width: 200px; height: 150px;">
        <img style="width: 100px;" src="https://4re5group.github.io/public/external/pastedimage-tlvr-200h.png">
        <p>4re5 group - 2025, all rights reserved</p>
    </div>
    <div>
        <button onclick="getRepo()">Load current repo</button>
        <button onclick="addNewApp()">Add new app</button>
        <button onclick="copyToClipboard()">Copy json</button>
    </div>
    <div style="width: 100%; height: 80%; display: flex; margin-top: 20px;">
        <!-- left -->
        <div style="overflow-x: hidden; overflow-y: scroll; width: 50%; height: 100%; display: flex; flex-direction: column; padding-right: 10px;">
            <label>Disabled<input id="disabled" type="checkbox"></label>
            
            <label>Name</label>
            <input id="name" type="text" placeholder="">
            <label>Description</label>
            <input id="description" type="text" placeholder="">
            <img id="preview-image" style="width: 100px; height: 100px; object-fit: contain; background: #444;" src="">
            <label>Image</label>
            <input id="image" type="text" placeholder="" onchange="document.getElementById('preview-image').src = this.value">
            <label>Creation date</label>
            <input id="first-date" type="date">
            
            <label>Type</label>
            <div style="display: flex; gap: 10px;">
                <label>app<input name="type" id="type-app" value="app" type="radio"></label>
                <label>server<input name="type" id="type-server" value="server" type="radio"></label>
                <label>cli<input name="type" id="type-cli" value="cli" type="radio"></label>
            </div>
            
            <label>Author</label>
            <input id="author" type="text" placeholder="" value="4re5 group">
            <label>Price (in $)</label>
            <input id="price" type="number" value="0">
            <label>Github url</label>
            <input id="github" type="text" placeholder="" value="https://github.com/4re5group/">
            <label>Documentation url</label>
            <input id="docs" type="text" placeholder="" value="https://github.com/4re5group/">
            <label>License</label>
            <input id="license" type="text" placeholder="" value="GNU GPL 3.0">
            
            <label>Package</label>
            <input id="package" type="text" placeholder="" value="com.ares.">
            
            <label>Keywords (comma separated)</label>
            <input id="keywords" type="text" placeholder="Tool, Utility">

            <!-- platform -->
            <div id="win" style="padding: 10px; width: 100%; display: flex; flex-direction: column; margin-top: 10px; background-color: gray;">
                <h1>Windows <input type="checkbox" id="windows" onclick="document.getElementById('win').style.background = document.getElementById('windows').checked?'transparent':'grey';"></h1>
                <label>Download url</label>
                <input id="win-download_url" type="text">
                <label>Version</label>
                <input id="win-version" type="text" value="1.0">
                <label>Dependencies (comma separated)</label>
                <input id="win-dependencies" type="text" value="">
                <label>Startup File</label>
                <input id="win-startUpFile" type="text">
                <label>Is Cmd Tool <input id="win-isCmdTool" type="checkbox"></label>
                
                <label>Artifact Type</label>
                <select id="win-artifactType">
                    <option value="binary">binary</option>
                    <option value="installer">installer</option>
                </select>
                <label>Checksum</label>
                <input id="win-checksum" type="text" placeholder="sha256:...">
                <label>Install Scope</label>
                <select id="win-installScope">
                    <option value="user">user</option>
                    <option value="system">system</option>
                </select>
            </div>

            <div id="and" style="padding: 10px; width: 100%; display: flex; flex-direction: column; margin-top: 10px; background-color: gray;">
                <h1>Android <input type="checkbox" id="android" onclick="document.getElementById('and').style.background = document.getElementById('android').checked?'transparent':'grey';"></h1>
                <label>Download url</label>
                <input id="and-download_url" type="text">
                <label>Version</label>
                <input id="and-version" type="text" value="1.0">
                <label>Dependencies (comma separated)</label>
                <input id="and-dependencies" type="text" value="">
                <label>Startup File</label>
                <input id="and-startUpFile" type="text">
                <label>Is Cmd Tool <input id="and-isCmdTool" type="checkbox"></label>
                
                <label>Artifact Type</label>
                <select id="and-artifactType">
                    <option value="apk">apk</option>
                </select>
                <label>Checksum</label>
                <input id="and-checksum" type="text" placeholder="sha256:...">
                <label>Install Scope</label>
                <select id="and-installScope">
                    <option value="user">user</option>
                    <option value="system">system</option>
                </select>
            </div>

            <div id="lin" style="padding: 10px; width: 100%; display: flex; flex-direction: column; margin-top: 10px; background-color: gray;">
                <h1>Linux <input type="checkbox" id="linux" onclick="document.getElementById('lin').style.background = document.getElementById('linux').checked?'transparent':'grey';"></h1>
                <label>Download url</label>
                <input id="lin-download_url" type="text">
                <label>Version</label>
                <input id="lin-version" type="text" value="1.0">
                <label>Dependencies (comma separated)</label>
                <input id="lin-dependencies" type="text" value="">
                <label>Startup File</label>
                <input id="lin-startUpFile" type="text">
                <label>Is Cmd Tool <input id="lin-isCmdTool" type="checkbox"></label>
                
                <label>Artifact Type</label>
                <select id="lin-artifactType">
                    <option value="binary">binary</option>
                    <option value="deb">deb</option>
                </select>
                <label>Checksum</label>
                <input id="lin-checksum" type="text" placeholder="sha256:...">
                <label>Install Scope</label>
                <select id="lin-installScope">
                    <option value="user">user</option>
                    <option value="system">system</option>
                </select>
            </div>

            <button id="save" onclick="saveapp()" style="margin-top: 20px; padding: 10px;">Save Changes</button>
        </div>
        <!-- right -->
        <div style="margin-left: 20px; width: 50%; height: 100%; display: flex; flex-direction: column;">
            <div style="width: 100%; height: 50%; overflow-y: scroll; background: #222; padding: 10px;">
                <p style="margin-top: 0;">JSON output:</p>
                <pre id="json-output" style="white-space: pre-wrap; word-wrap: break-word;">{}</pre>
            </div>
            <div id="arbo" style="overflow-y: scroll; background-color: #444; width: 100%; height: 50%; display: flex; flex-direction: column; gap: 5px; padding: 10px;">

            </div>
            
        </div>
    </div>
    

    <script>
        function copyToClipboard() {
            var copyText = document.getElementById("json-output");
            navigator.clipboard.writeText(copyText.innerText);
            alert("Copied JSON to clipboard");
        }

        function addNewApp() {
            if (!map) map = [];
            map.push({
                "disabled": false,
                "name": "New App",
                "description": "",
                "price": "free",
                "github": "https://github.com/4RE5group/...",
                "image": "",
                "type": "cli",
                "docs": "",
                "first_date": new Date().toISOString().split('T')[0],
                "author": "4re5 group",
                "license": "GNU GPL 3.0",
                "package": "com.ares.",
                "platform": [],
                "keywords": []
            });
            renderList();
            loadapp(map.length - 1);
        }

        function renderList() {
            var arbo = document.getElementById("arbo");
            arbo.innerHTML = "";
            map.forEach((element, index) => {
                let btn = document.createElement("button");
                btn.innerText = element.name;
                btn.onclick = () => loadapp(index);
                btn.style.padding = "5px";
                btn.style.textAlign = "left";
                arbo.appendChild(btn);
            });
        }

        function saveapp() {
            if (!map || map.length === 0) {
                alert("No app loaded!");
                return;
            }
            
            let app = map[current_app];
            app.name = document.getElementById("name").value;
            app.description = document.getElementById("description").value;
            app.image = document.getElementById("image").value;
            app.first_date = document.getElementById("first-date").value;
            app.author = document.getElementById("author").value;
            app.disabled = document.getElementById("disabled").checked;

            if (document.getElementById("price").value == 0)
                app.price = "free";
            else
                app.price = "$" + document.getElementById("price").value;

            app.github = document.getElementById("github").value;
            app.license = document.getElementById("license").value;
            app.package = document.getElementById("package").value;
            app.docs = document.getElementById("docs").value;

            // Type
            if (document.getElementById("type-app").checked) app.type = "app";
            else if (document.getElementById("type-server").checked) app.type = "server";
            else if (document.getElementById("type-cli").checked) app.type = "cli";
            
            // Keywords
            let kw = document.getElementById("keywords").value;
            app.keywords = kw ? kw.split(",").map(s => s.trim()).filter(s => s) : [];

            // Platforms
            var platform = [];
            
            // Windows
            if (document.getElementById("windows").checked) {
                platform.push({
                    "platform": "windows",
                    "url": document.getElementById("win-download_url").value,
                    "version": document.getElementById("win-version").value,
                    "dependencies": document.getElementById("win-dependencies").value.split(",").map(s => s.trim()).filter(s => s),
                    "isCmdTool": document.getElementById("win-isCmdTool").checked,
                    "startUpFile": document.getElementById("win-startUpFile").value,
                    "artifactType": document.getElementById("win-artifactType").value,
                    "checksum": document.getElementById("win-checksum").value,
                    "installScope": document.getElementById("win-installScope").value
                });
            }
            
            // Android
            if (document.getElementById("android").checked) {
                platform.push({
                    "platform": "android",
                    "url": document.getElementById("and-download_url").value,
                    "version": document.getElementById("and-version").value,
                    "dependencies": document.getElementById("and-dependencies").value.split(",").map(s => s.trim()).filter(s => s),
                    "isCmdTool": document.getElementById("and-isCmdTool").checked,
                    "startUpFile": document.getElementById("and-startUpFile").value,
                    "artifactType": document.getElementById("and-artifactType").value,
                    "checksum": document.getElementById("and-checksum").value,
                    "installScope": document.getElementById("and-installScope").value
                });
            }
            
            // Linux
            if (document.getElementById("linux").checked) {
                platform.push({
                    "platform": "linux",
                    "url": document.getElementById("lin-download_url").value,
                    "version": document.getElementById("lin-version").value,
                    "dependencies": document.getElementById("lin-dependencies").value.split(",").map(s => s.trim()).filter(s => s),
                    "isCmdTool": document.getElementById("lin-isCmdTool").checked,
                    "startUpFile": document.getElementById("lin-startUpFile").value,
                    "artifactType": document.getElementById("lin-artifactType").value,
                    "checksum": document.getElementById("lin-checksum").value,
                    "installScope": document.getElementById("lin-installScope").value
                });
            }
            
            app.platform = platform;

            renderList();
            document.getElementById("json-output").innerText = JSON.stringify(map, null, 2);
        }

        function getRepo() {
            fetch("https://raw.githubusercontent.com/4RE5group/4re5-repository/refs/heads/main/repo.json")
            .then(response => response.text())
            .then(data => {
                try {
                    map = JSON.parse(data);
                    renderList();
                    if (map.length > 0) loadapp(0);
                    document.getElementById("json-output").innerText = JSON.stringify(map, null, 2);
                } catch (e) {
                    alert("Error parsing JSON: " + e);
                }
            })
            .catch(err => alert("Error fetching repo: " + err));
        }

        function loadapp(id) {
            if (!map || !map[id]) return;
            current_app = id;
            let app = map[id];
            
            document.getElementById("name").value = app.name || "";
            document.getElementById("description").value = app.description || "";
            document.getElementById("image").value = app.image || "";
            document.getElementById("preview-image").src = app.image || "";
            document.getElementById("first-date").value = app.first_date || "";
            document.getElementById("author").value = app.author || "";
            document.getElementById("disabled").checked = app.disabled === true || app.disabled === "true";

            if (app.price == "free")
                document.getElementById("price").value = 0;
            else
                document.getElementById("price").value = (app.price || "").replace("$", "");

            document.getElementById("github").value = app.github || "";
            document.getElementById("docs").value = app.docs || "";
            document.getElementById("license").value = app.license || "";
            document.getElementById("package").value = app.package || "";
            
            document.getElementById("keywords").value = (app.keywords || []).join(", ");

            // Reset platforms
            document.getElementById("win").style.background = "grey";
            document.getElementById("windows").checked = false;
            document.getElementById("and").style.background = "grey";
            document.getElementById("android").checked = false;
            document.getElementById("lin").style.background = "grey";
            document.getElementById("linux").checked = false;

            // Type
            let typeStr = app.type || "";
            document.getElementById("type-app").checked = typeStr.includes("app");
            document.getElementById("type-server").checked = typeStr.includes("server");
            document.getElementById("type-cli").checked = typeStr.includes("cli");

            // Platforms
            if (app.platform) {
                app.platform.forEach(p => {
                    let plat = p.platform ? p.platform.toLowerCase() : (p.name ? p.name.toLowerCase() : "");
                    if (p.platformid === 0) plat = "windows";
                    if (p.platformid === 1) plat = "android";
                    if (p.platformid === 2) plat = "linux";

                    let deps = p.dependencies || p.install_requires || [];
                    let isCmd = p.isCmdTool === true || p.isCmdTool === "true";

                    if (plat === "windows") {
                        document.getElementById("win").style.background = "transparent";
                        document.getElementById("windows").checked = true;
                        document.getElementById("win-version").value = p.version || "";
                        document.getElementById("win-download_url").value = p.url || "";
                        document.getElementById("win-dependencies").value = Array.isArray(deps) ? deps.join(", ") : deps;
                        document.getElementById("win-startUpFile").value = p.startUpFile || "";
                        document.getElementById("win-isCmdTool").checked = isCmd;
                        document.getElementById("win-artifactType").value = p.artifactType || "binary";
                        document.getElementById("win-checksum").value = p.checksum || "";
                        document.getElementById("win-installScope").value = p.installScope || "user";
                    } else if (plat === "android") {
                        document.getElementById("and").style.background = "transparent";
                        document.getElementById("android").checked = true;
                        document.getElementById("and-version").value = p.version || "";
                        document.getElementById("and-download_url").value = p.url || "";
                        document.getElementById("and-dependencies").value = Array.isArray(deps) ? deps.join(", ") : deps;
                        document.getElementById("and-startUpFile").value = p.startUpFile || "";
                        document.getElementById("and-isCmdTool").checked = isCmd;
                        document.getElementById("and-artifactType").value = p.artifactType || "apk";
                        document.getElementById("and-checksum").value = p.checksum || "";
                        document.getElementById("and-installScope").value = p.installScope || "user";
                    } else if (plat === "linux") {
                        document.getElementById("lin").style.background = "transparent";
                        document.getElementById("linux").checked = true;
                        document.getElementById("lin-version").value = p.version || "";
                        document.getElementById("lin-download_url").value = p.url || "";
                        document.getElementById("lin-dependencies").value = Array.isArray(deps) ? deps.join(", ") : deps;
                        document.getElementById("lin-startUpFile").value = p.startUpFile || "";
                        document.getElementById("lin-isCmdTool").checked = isCmd;
                        document.getElementById("lin-artifactType").value = p.artifactType || "binary";
                        document.getElementById("lin-checksum").value = p.checksum || "";
                        document.getElementById("lin-installScope").value = p.installScope || "user";
                    }
                });
            }
        }
    </script>
</body>
</html>
